{% extends "common/common.html" %}

{% block css %}
<link rel="stylesheet" type="text/css" href="Template/weeklyReport/weeklyReport.css"/>
{% endblock %}

{% block main %}
<div class="container">
    <!-- 背景装饰层 -->
    <div class="bg-grid"></div>
    
    <!-- 头部区域 -->
    <div class="header">
        <div class="header-left">
            <div class="logo-box">
                <img src="imgs/others/logo.png" alt="Logo" />
            </div>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-name-row">
                    <div class="user-name">{{ userName }}</div>
                </div>
                {% if date %}
                <div class="report-date">周报日期: {{ date[0:4] }}-{{ date[4:6] }}-{{ date[6:8] }}</div>
                {% endif %}
            </div>
            <div class="avatar-wrapper">
                <img src="{{ userAvatar }}" alt="Avatar" data-qq-avatar="{{ qqAvatarUrl }}" onerror="if(this.dataset.qqAvatar){this.src=this.dataset.qqAvatar;this.onerror=null;}" />
            </div>
        </div>
    </div>

    {% if solData %}
    <!-- 烽火地带数据看板 -->
    <div class="dashboard-section">
        <div class="dashboard-grid">
            <div class="data-node highlight">
                <div class="node-label">总对局 / TOTAL MATCHES</div>
                <span class="node-value large">{{ solData.total_sol_num | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">撤离 / EVACUATED</div>
                <span class="node-value large">{{ solData.total_exacuation_num | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">百万撤离 / MILLION+ EVAC</div>
                <span class="node-value large">{{ solData.GainedPrice_overmillion_num | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">死亡 / ELIMINATED</div>
                <span class="node-value large">{{ solData.total_Death_Count | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">玩家击杀 / PLAYER KILLS</div>
                <span class="node-value">{{ solData.total_Kill_Player | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">AI击杀 / AI KILLS</div>
                <span class="node-value">{{ solData.total_Kill_AI | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">BOSS击杀 / BOSS KILLS</div>
                <span class="node-value">{{ solData.total_Kill_Boss | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">段位 / RANK</div>
                <div class="rank-display">
                    {% if solData.rankImagePath %}
                    <img src="{{ solData.rankImagePath }}" class="rank-img" alt="{{ solData.rankName }}" onerror="this.style.display='none';" />
                    {% endif %}
                    <span class="node-value">{{ solData.rankName | default('-') }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 资产趋势 -->
    {% if solData.assetTrend %}
    <div class="section-block">
        <div class="section-header">
            <span class="dot"></span> 资产趋势 / ASSET TREND
        </div>
        <div class="chart-container">
            <div class="line-chart-wrapper">
                <svg class="line-chart-svg" viewBox="0 0 {{ solData.assetTrend.chartWidth }} {{ solData.assetTrend.chartHeight }}" preserveAspectRatio="xMidYMid meet">
                    <path class="line-chart-path" d="{{ solData.assetTrend.pathData }}" 
                          fill="none" stroke="#0FF796" stroke-width="3" 
                          stroke-linecap="round" stroke-linejoin="round"/>
                    {% for point in solData.assetTrend.allDays %}
                    <g class="line-chart-point-group">
                        <circle class="line-chart-point" cx="{{ point.x }}" cy="{{ point.y }}" 
                                r="5" fill="#0FF796" stroke="#0a0a0a" stroke-width="2"/>
                        <text class="line-chart-value-text" x="{{ point.x }}" y="{{ point.y }}" 
                              text-anchor="middle" dy="-18" 
                              font-size="14" font-weight="800" 
                              font-family="Arial, sans-serif" dominant-baseline="middle">
                            {{ point.price }}
                        </text>
                    </g>
                    {% endfor %}
                </svg>
                <div class="line-chart-labels">
                    {% for point in solData.assetTrend.allDays %}
                    <div class="line-chart-label-item" style="left: {{ point.xPercent }}%">
                        <span class="line-chart-label">{{ point.dayName }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="chart-summary">
                <span class="chart-summary-text">{{ solData.assetTrend.startPrice }} ➔ {{ solData.assetTrend.endPrice }}</span>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- 资产统计 -->
    <div class="section-block">
        <div class="section-header">
            <span class="dot"></span> 资产统计 / ASSET STATISTICS
        </div>
        <div class="dashboard-grid asset-grid">
            <div class="data-node highlight asset-card">
                <div class="node-label">资产净增 / NET INCREASE</div>
                <span class="node-value large">{{ solData.rise_Price | default(0) }}</span>
                <div class="node-detail">(总收益 {{ solData.Gained_Price | default(0) }} / 总消费 {{ solData.consume_Price | default(0) }})</div>
            </div>
            {% if solData.profitRatio %}
            <div class="data-node highlight asset-card">
                <div class="node-label">赚损比 / PROFIT RATIO</div>
                <span class="node-value large">{{ solData.profitRatio }}</span>
                <div class="node-detail">(收益/消费)</div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- 游戏行为 -->
    <div class="section-block">
        <div class="section-header">
            <span class="dot"></span> 游戏行为 / GAME ACTIONS
        </div>
        <div class="dashboard-grid">
            <div class="data-node highlight">
                <div class="node-label">任务 / QUESTS</div>
                <span class="node-value large">{{ solData.total_Quest_num | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">使用钥匙 / KEYS USED</div>
                <span class="node-value large">{{ solData.use_Keycard_num | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">破译 / DECRYPTIONS</div>
                <span class="node-value large">{{ solData.Mandel_brick_num | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">搜鸟巢 / BIRD NESTS</div>
                <span class="node-value large">{{ solData.search_Birdsnest_num | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">里程 / MILEAGE</div>
                <span class="node-value highlight-green">{{ solData.mileage | default(0) }}km</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">救援 / RESCUES</div>
                <span class="node-value large">{{ solData.total_Rescue_num | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">被鳄鱼偷袭 / CROCODILE ATTACKS</div>
                <span class="node-value large">{{ solData.Kill_ByCrocodile_num | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">游戏时长 / GAME TIME</div>
                <span class="node-value highlight-green">{{ solData.gameTime | default('-') }}</span>
            </div>
        </div>
    </div>

    <!-- 常玩内容 -->
    <div class="section-block">
        <div class="section-header">
            <span class="dot"></span> 常玩内容 / FAVORITE CONTENT
        </div>
        <div class="favorite-grid">
            {% if solData.mostUsedMapImagePath %}
            <div class="favorite-card">
                <div class="favorite-bg" style="background-image: url('{{ solData.mostUsedMapImagePath }}');"></div>
                <div class="favorite-content">
                    <div class="favorite-label">常玩地图 / FAVORITE MAP</div>
                </div>
            </div>
            {% endif %}
            {% if solData.mostUsedOperatorImagePath %}
            <div class="favorite-card">
                <div class="favorite-bg" style="background-image: url('{{ solData.mostUsedOperatorImagePath }}');"></div>
                <div class="favorite-content">
                    <div class="favorite-label">常玩干员 / FAVORITE OPERATOR</div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% if mpData %}
    <!-- 全面战场数据 -->
    <div class="section-block mp-section">
         <div class="section-header">
            <span class="dot"></span> 全面战场 / BATTLEFIELD
        </div>
        <div class="dashboard-grid mp-grid">
             <div class="data-node highlight">
                <div class="node-label">总对局 / MATCHES</div>
                <span class="node-value large">{{ mpData.total_inum | default(0) }}</span>
            </div>
             <div class="data-node highlight">
                <div class="node-label">胜场 / WINS</div>
                <span class="node-value large">{{ mpData.total_win_inum | default(0) }}</span>
            </div>
             <div class="data-node highlight">
                <div class="node-label">击杀 / KILLS</div>
                <span class="node-value highlight-green">{{ mpData.total_killnum | default(0) }}</span>
            </div>
             <div class="data-node highlight">
                <div class="node-label">阵亡 / DEATHS</div>
                <span class="node-value large">{{ mpData.total_deathnum | default(0) }}</span>
            </div>
             <div class="data-node highlight">
                <div class="node-label">助攻 / ASSISTS</div>
                <span class="node-value large">{{ mpData.total_assistnum | default(0) }}</span>
            </div>
             <div class="data-node highlight">
                <div class="node-label">总分 / SCORE</div>
                <span class="node-value large">{{ mpData.total_scorenum | default(0) }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">时长 / TIME</div>
                <span class="node-value large">{{ mpData.total_time | default(0) }}</span>
            </div>
        </div>
        
        <!-- 队友列表 -->
        {% if mpData.teammates and mpData.teammates | length > 0 %}
        <div class="teammates-box">
            <div class="section-header small">常玩队友 / TEAMMATES</div>
            <div class="teammates-list">
                {% for mate in mpData.teammates %}
                <div class="teammate-item">
                    <div class="teammate-name">{{ mate.name }}</div>
                    <div class="teammate-count">{{ mate.count }} 局</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- 队友列表 (烽火地带) -->
    {% if solData and solData.teammates and solData.teammates | length > 0 %}
    <div class="section-block">
        <div class="section-header">
            <span class="dot"></span> 烽火队友 / TEAMMATES (HAZARD)
        </div>
        <div class="teammates-list">
             {% for mate in solData.teammates %}
                <div class="teammate-item">
                    <div class="teammate-name">{{ mate.name }}</div>
                    <div class="teammate-count">{{ mate.count }} 局</div>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- 底部 -->
    <div class="footer">
        Data source: Official API | Powered by Delta-Force-Plugin
    </div>
</div>
{% endblock %}

