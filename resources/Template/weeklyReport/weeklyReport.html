{% extends "common/common.html" %}
{% block css %}
<link rel="stylesheet" type="text/css" href="{{ _res_path }}Template/weeklyReport/weeklyReport.css"/>
{% endblock %}
{% block main %}
<div class="container {% if mpData %}mp-theme{% endif %}">
    <!-- 背景装饰层 -->
    <div class="bg-grid"></div>
    
    <!-- 头部区域 -->
    <div class="header">
        <div class="header-left">
            <div class="logo-box">
                <img src="{{ _res_path }}imgs/others/logo.png" alt="Logo" />
            </div>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-name-row">
                    <div class="report-type">周报</div>
                    <div class="user-name">{{ userName }}</div>
                </div>
                <div class="report-date">{{ reportPeriod }}</div>
            </div>
            <div class="avatar-wrapper">
                <img src="{{ userAvatar }}" alt="Avatar" data-qq-avatar="{{ qqAvatarUrl }}" onerror="if(this.dataset.qqAvatar){this.src=this.dataset.qqAvatar;this.onerror=null;}" />
            </div>
        </div>
    </div>

    <!-- 烽火地带数据 -->
    {% if solData %}
    <div class="section-block sol-section">
        <div class="section-header">
            <span class="dot"></span> 烽火地带数据 / OPERATION STATS
        </div>

        <!-- 数据看板 -->
        <div class="dashboard-grid">
            <div class="data-node highlight">
                <div class="node-label">对局 / FIGHTS</div>
                <span class="node-value large">{{ solData.totalFight if solData.totalFight else '0' }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">撤离 / ESCAPES</div>
                <span class="node-value large">{{ solData.totalEscape if solData.totalEscape else '0' }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">总击杀 / KILLS</div>
                <span class="node-value large">{{ solData.totalKill if solData.totalKill else '0' }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">总收益 / PROFIT</div>
                <span class="node-value large {{ 'positive' if solData.totalProfit > 0 else 'negative' }}">{{ solData.totalProfitFormatted if solData.totalProfitFormatted else '0' }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">大红收藏 / RED COLLECTIONS</div>
                <span class="node-value">{{ solData.redCollectionCount if solData.redCollectionCount else '0' }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">游戏时长 / PLAYTIME</div>
                <span class="node-value">{{ solData.totalGameTime if solData.totalGameTime else '-' }}</span>
            </div>
        </div>

        <!-- 资产趋势图 -->
        {% if solData.assetTrend and solData.assetTrend.points and solData.assetTrend.points|length > 0 %}
        <div class="chart-section">
            <div class="chart-title">资产趋势 / ASSET TREND</div>
            <div class="chart-wrapper">
                <svg class="trend-chart" viewBox="0 0 {{ solData.assetTrend.svgWidth }} {{ solData.assetTrend.svgHeight }}">
                    <!-- 网格线 -->
                    <g class="grid-lines">
                        {% for i in range(5) %}
                        <line x1="50" y1="{{ 40 + i * 60 }}" x2="{{ solData.assetTrend.svgWidth - 30 }}" y2="{{ 40 + i * 60 }}" stroke="#333" stroke-dasharray="4,4" />
                        {% endfor %}
                    </g>
                    <!-- 折线 -->
                    <polyline class="trend-line" points="{% for point in solData.assetTrend.points %}{{ point.x }},{{ point.y }}{% if not loop.last %} {% endif %}{% endfor %}" fill="none" stroke="#00d4ff" stroke-width="2" />
                    <!-- 数据点 -->
                    {% for point in solData.assetTrend.points %}
                    <circle class="trend-point" cx="{{ point.x }}" cy="{{ point.y }}" r="4" fill="#00d4ff" />
                    <text class="point-label" x="{{ point.x }}" y="{{ point.y - 10 }}" text-anchor="middle" fill="#fff" font-size="10">{{ point.label }}</text>
                    {% endfor %}
                </svg>
            </div>
        </div>
        {% endif %}

        <!-- 常用干员 -->
        {% if solData.operators and solData.operators|length > 0 %}
        <div class="operators-section">
            <div class="section-subtitle">常用干员 / OPERATORS</div>
            <div class="operators-list">
                {% for op in solData.operators %}
                <div class="operator-card">
                    {% if op.operatorImage %}
                    <img class="operator-img" src="{{ _res_path }}{{ op.operatorImage }}" alt="{{ op.operatorName }}" onerror="this.style.display='none';" />
                    {% endif %}
                    <div class="operator-info">
                        <div class="operator-name">{{ op.operatorName }}</div>
                        <div class="operator-stats">对局: {{ op.fightCount }} | 撤离: {{ op.escapeCount }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- 常玩地图 -->
        {% if solData.maps and solData.maps|length > 0 %}
        <div class="maps-section">
            <div class="section-subtitle">常玩地图 / MAPS</div>
            <div class="maps-list">
                {% for map in solData.maps %}
                <div class="map-card">
                    {% if map.mapImage %}
                    <img class="map-bg" src="{{ _res_path }}{{ map.mapImage }}" alt="{{ map.mapName }}" onerror="this.style.display='none';" />
                    {% endif %}
                    <div class="map-content">
                        <div class="map-name">{{ map.mapName }}</div>
                        <div class="map-stats">对局: {{ map.totalCount }} | 撤离: {{ map.leaveCount }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- 队友排行 -->
        {% if solData.teammates and solData.teammates|length > 0 %}
        <div class="teammates-section">
            <div class="section-subtitle">队友排行 / TEAMMATES</div>
            <div class="teammates-list">
                {% for teammate in solData.teammates %}
                <div class="teammate-card">
                    <div class="teammate-rank">{{ loop.index }}</div>
                    <div class="teammate-info">
                        <div class="teammate-name">{{ teammate.name }}</div>
                        <div class="teammate-stats">组队: {{ teammate.count }}次</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- 全面战场数据 -->
    {% if mpData %}
    <div class="section-block mp-section">
        <div class="section-header">
            <span class="dot"></span> 全面战场数据 / BATTLEFIELD STATS
        </div>

        <!-- 数据看板 -->
        <div class="dashboard-grid mp-grid">
            <div class="data-node highlight">
                <div class="node-label">对局 / FIGHTS</div>
                <span class="node-value large">{{ mpData.totalFight if mpData.totalFight else '0' }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">胜利 / WINS</div>
                <span class="node-value large">{{ mpData.totalWin if mpData.totalWin else '0' }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">胜率 / WIN RATE</div>
                <span class="node-value large">{{ mpData.winRatio ~ '%' if mpData.winRatio else '-' }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">总得分 / TOTAL SCORE</div>
                <span class="node-value large">{{ '{:,}'.format(mpData.totalScore) if mpData.totalScore else '0' }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">总击杀 / KILLS</div>
                <span class="node-value">{{ mpData.totalKill if mpData.totalKill else '0' }}</span>
            </div>
            <div class="data-node highlight">
                <div class="node-label">游戏时长 / PLAYTIME</div>
                <span class="node-value">{{ mpData.totalGameTime if mpData.totalGameTime else '-' }}</span>
            </div>
        </div>

        <!-- 常玩地图 -->
        {% if mpData.maps and mpData.maps|length > 0 %}
        <div class="maps-section">
            <div class="section-subtitle">常玩地图 / MAPS</div>
            <div class="maps-list">
                {% for map in mpData.maps %}
                <div class="map-card">
                    {% if map.mapImage %}
                    <img class="map-bg" src="{{ _res_path }}{{ map.mapImage }}" alt="{{ map.mapName }}" onerror="this.style.display='none';" />
                    {% endif %}
                    <div class="map-content">
                        <div class="map-name">{{ map.mapName }}</div>
                        <div class="map-stats">对局: {{ map.totalCount }} | 胜利: {{ map.leaveCount }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

</div>
{% endblock %}
{% block footer %}
{% endblock %}
